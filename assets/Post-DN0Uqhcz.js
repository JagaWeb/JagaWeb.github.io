import{_ as Q,j as $,r as p,w as E,o as W,i as v,a as m,k as g,C as z,b as i,n,u as t,d as M,I as w,g as I,t as k,x as S,R as V,f as U,h}from"./index-Nl0riu4T.js";const X={class:"like_and_comment"},Y=["disabled"],Z={key:3,class:"loader"},ee={key:1,class:"loader"},te={class:"post_description"},se={class:"post_text"},oe={class:"user_and_other"},ie={class:"user"},ae={class:"logo"},ne={class:"logo_name"},le={class:"other"},ue={key:0},re={key:1,class:"loader"},ce={class:"other_icon"},de=["disabled"],pe=["disabled"],ve={__name:"Post",props:{postOption:{type:Object,return:!0}},setup(s){const x=s,l=$("theme"),y=$("confirmation"),r=$("user_Id"),_=$("urlAdressAuth"),N=$("urlAdressPosts"),C=$("commnetId"),A=p(!1),c=p(!1),R=p(null),j=p(!1),B=p(!1),d=p(null),P=p(),O=p([]),b=p([]),L=p(!1),T=async a=>{try{const e=await h.get(`${N}/${a}`),o=(await h.get(`${_}?user_id=${r}`)).data[0].post_like.includes(x.postOption.image_id);A.value=o,d.value=e.data.like,R.value=e.data.comment.length}catch(e){console.log(e)}},F=async()=>{try{const e=(await h.get(`${_}?user_id=${r}`)).data[0].users_subsribe.includes(x.postOption.user_id);j.value=e,B.value=!1,y.value.subscribe=!1}catch(a){console.log(a)}},q=async(a,e,u)=>{c.value=!0;try{if(!r){console.error("UserId не найден в localStorage"),c.value=!1;return}const o=await h.get(`${_}?user_id=${r}`);if(!o.data||!o.data[0]){console.error("Данные пользователя не найдены"),c.value=!1;return}O.value=o.data[0].post_like;const D=O.value.findIndex(f=>f===u);if(D!==-1){O.value.splice(D,1),P.value=e,P.value--,d.value=null;try{const f=await h.put(`${_}/${o.data[0].id}`,{post_like:O.value})}catch(f){console.error("Ошибка при обновлении данных:",f),c.value=!1}}else{O.value.push(u),P.value=e,P.value++,d.value=null;try{const f=await h.put(`${_}/${o.data[0].id}`,{post_like:O.value})}catch(f){console.error("Ошибка при обновлении данных:",f),c.value=!1}}}catch(o){console.error("Ошибка при получении данных пользователя:",o),c.value=!1}try{const o=await h.put(`${N}/${a}`,{like:P.value});c.value=!1,o.status==200&&T(a)}catch(o){console.log(o),c.value=!1}},G=async a=>{B.value=!0;try{if(!r){console.error("UserId не найден в localStorage");return}const e=await h.get(`${_}?user_id=${r}`);if(!e.data||!e.data[0]){console.error("Данные пользователя не найдены");return}b.value=e.data[0].users_subsribe;const u=b.value.findIndex(o=>o===a);if(u!==-1){b.value.splice(u,1);try{const o=await h.put(`${_}/${e.data[0].id}`,{users_subsribe:b.value});b.value=[]}catch(o){console.error("Ошибка при обновлении данных:",o)}}else{b.value.push(a);try{const o=await h.put(`${_}/${e.data[0].id}`,{users_subsribe:b.value});b.value=[]}catch(o){console.error("Ошибка при обновлении данных:",o)}}y.value.subscribe=!0}catch(e){console.error("Ошибка при получении данных пользователя:",e)}},H=(a,e)=>{C.value.id=a,C.value.uId=e},J=()=>{L.value=!L.value},K=a=>{y.value.id=a,y.value.deletePost=!0,y.value.active=!0};return E(()=>{y.value.subscribe&&F()}),E(()=>{C.value.uId===x.postOption.user_id&&C.value.id===null&&T(x.postOption.id)}),W(()=>{T(x.postOption.id),F()}),(a,e)=>(v(),m("section",{class:n(["post_container",t(l)?"themeBgwhite":"themeBgblack"])},[g(z,{src:s.postOption.image,style:{"border-radius":"30px",overflow:"hidden"}},null,8,["src"]),i("div",X,[i("button",{onClick:e[0]||(e[0]=u=>q(s.postOption.id,d.value,s.postOption.image_id)),class:n(["like",t(l)?"light":"night",{like_active:A.value}]),disabled:d.value===null||c.value},[!A.value&&d.value!==null?(v(),M(t(w),{key:0,icon:"icon-park-outline:like",width:"40",height:"40",class:n(t(l)?"input_light":"input_night")},null,8,["class"])):I("",!0),A.value&&d.value!==null?(v(),M(t(w),{key:1,icon:"icon-park-solid:like",width:"40",height:"40",style:{color:"red"}})):I("",!0),d.value!==null?(v(),m("h3",{key:2,class:n(t(l)?"input_light":"input_night")},k(d.value),3)):c.value==!0||d.value==null?(v(),m("div",Z)):I("",!0)],10,Y),i("button",{class:n(["comment",t(l)?"light":"night"]),onClick:e[1]||(e[1]=u=>H(s.postOption.id,s.postOption.user_id))},[g(t(w),{icon:"fa6-solid:comment-dots",width:"40",height:"40",class:n(t(l)?"input_light":"input_night")},null,8,["class"]),R.value!==null?(v(),m("h3",{key:0,class:n(t(l)?"input_light":"input_night")},k(R.value),3)):(v(),m("div",ee))],2)]),i("div",te,[i("h2",{class:n(["post_title",t(l)?"input_light":"input_night"])},k(s.postOption.title),3),i("p",se,k(s.postOption.description),1),i("div",oe,[i("div",ie,[i("div",ae,[g(t(V),{to:{name:"userProfile",params:{id:s.postOption.user_id}}},{default:S(()=>[g(z,{src:s.postOption.user_logo,height:"50px"},null,8,["src"])]),_:1},8,["to"])]),i("div",ne,[g(t(V),{to:{name:"userProfile",params:{id:s.postOption.user_id}}},{default:S(()=>[i("h2",{class:n(t(l)?"input_light":"input_night")},k(s.postOption.user_name),3)]),_:1},8,["to"]),i("h3",{class:n(t(l)?"input_light":"input_night")},k(s.postOption.date),3)])]),i("div",le,[s.postOption.user_id!==t(r)?(v(),m("button",{key:0,onClick:e[2]||(e[2]=u=>G(s.postOption.user_id)),class:"other_subscribe"},[B.value?I("",!0):(v(),m("span",ue,k(j.value?"Отписатся":"Подписаться"),1)),B.value?(v(),m("div",re)):I("",!0)])):I("",!0),i("div",ce,[i("div",{class:n(["popover_container",t(l)?"themeBgwhite input_light":"themeBgblack input_night",{popover_container_active:L.value}])},[g(t(V),{to:{name:"editPosts",params:{id:s.postOption.id}}},{default:S(()=>[i("button",{class:n(["rename",{disabled_btn:s.postOption.user_id!==t(r)}]),disabled:s.postOption.user_id!==t(r)},[e[6]||(e[6]=U(" Редактировать ")),g(t(w),{icon:"iconamoon:edit-duotone",width:"30",height:"30"})],10,de)]),_:1},8,["to"]),i("button",{class:n(["delete",{disabled_btn:s.postOption.user_id!==t(r)}]),onClick:e[3]||(e[3]=u=>K(s.postOption.id)),disabled:s.postOption.user_id!==t(r)},[e[7]||(e[7]=U(" Удалить ")),g(t(w),{icon:"icon-park-twotone:delete-four",width:"30",height:"30"})],10,pe)],2),i("button",{class:"btnPopover",onClick:e[4]||(e[4]=u=>J()),onBlur:e[5]||(e[5]=u=>L.value=!1)},[g(t(w),{icon:"iconamoon:menu-kebab-vertical-circle-light",width:"50",height:"50",class:n(t(l)?"input_light":"input_night")},null,8,["class"])],32)])])])])],2))}},ge=Q(ve,[["__scopeId","data-v-ff9aa538"]]);export{ge as P};
